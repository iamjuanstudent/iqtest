/*
	A harness for iqtest

	Uses options on the TestGroup:
	groupTemplate: {name} = group name
	testTemplate: {name} = test name, {desc} = simple failure description
	itemTemplate: {fulltext} 

*/
(function(b){var d=b.impl.utility,c={group:'<pre><h1>Starting test group "<iq-name></iq-name>": <iq-groupresult></iq-groupresult></h1><div><div></div></div></pre>',testStart:'<h2>Starting test "<iq-name></iq-name>": <iq-testresult></iq-testresult></h2><div></div>',testEnd:"<h3><iq-count></iq-count> tests items finished.</h3>",itemStart:'<span style="color: blue;font-style: italic;">Running test #<iq-count></iq-count>: <iq-assertFuncName></iq-assertFuncName> "<iq-desc></iq-desc>"....</span><br/>',itemEnd:"<span><iq-fulltext></iq-fulltext></span><br/>",resultSuccess:'<span style="color:green"><iq-resulttext></iq-resulttext></span>',resultFail:'<span style="color:red"><iq-resulttext></iq-resulttext></span>',log:'<span style="color:purple"><iq-message></iq-message></span><br/>'};
b.templates=c;d.tmpReplace=function(e,f){d.each(f,function(h,g){if(typeof g==="string"||typeof g==="number"){var j=e.find("iq-"+h.toLowerCase());
j.replaceWith(d.format("<span>{0}</span>",g));}});return e;};function a(e){var f=e?c.resultSuccess:c.resultFail;
return d.tmpReplace($(f),{resulttext:e?"Passed":"Failed"});}d.extend(b.impl.TestGroup.prototype,{writer:function(e){var f=$(e);
f.empty();this.outputTarget=f;return this;},groupStart:function(e){var f=d.tmpReplace($(c.group).clone(),e);
this.outputTarget.append(f);this.groupWrapper=f;this.target=f.find("div:only-child:last");
},groupEnd:function(e){var f=a(e.passed);this.groupWrapper.find("iq-groupresult").replaceWith(f);
},render:function(e){this.outputTarget=e;d.each(this.tests,function(f,g){g.render();
});}});d.extend(b.impl.Test.prototype,{testStart:function(f){var e=d.tmpReplace($(c.testStart).clone(),f);
this.target=e.filter("div");this.group.target.append(e);},testEnd:function(g){var f,e=d.tmpReplace($(c.testEnd).clone(),g);
this.target.append(e);f=a(g.passed);this.target.find("iq-testresult").replaceWith(f);
},itemStart:function(f){var e=d.tmpReplace($(c.itemStart),f);this.itemTarget=e;this.target.append(e);
},itemEnd:function(e){if(e.passed){this.itemTarget.remove();}else{this.itemTarget.replaceWith(d.tmpReplace($(c.itemEnd).clone(),e));
}this.itemTarget=null;e.written=true;},log:function(e){this.target.append(d.tmpReplace($(c.log).clone(),{message:e}));
},render:function(){var e=this;d.each(e.results,function(f,g){if(!g.written){d.event(this.group.itemEnd,this.group,g);
}});}});b.writer=function(e){var f=new b.impl.TestGroup();f.writer(e);return f;};
}(iqtest));