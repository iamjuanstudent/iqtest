/*
	A harness for iqtest

	Uses options on the TestGroup:
	groupTemplate: {name} = group name
	testTemplate: {name} = test name, {desc} = simple failure description
	itemTemplate: {fulltext} 

*/
(function(b){var e=b.impl.utility,c,d={group:'<pre><h1>Starting test group "<iq-name></iq-name>": <iq-groupresult></iq-groupresult></h1><div><div></div></div></pre>',testStart:'<h2>Starting test "<iq-name></iq-name>": <iq-testresult></iq-testresult></h2><div></div>',testEnd:"<h3><iq-count></iq-count> tests items finished.</h3>",itemStart:'<span style="color: blue;font-style: italic;">Running test #<iq-count></iq-count>: <iq-assertFuncName></iq-assertFuncName> "<iq-desc></iq-desc>"....</span><br/>',itemEnd:"<span><iq-fulltext></iq-fulltext></span><br/>",resultSuccess:'<span style="color:green"><iq-resulttext></iq-resulttext></span>',resultFail:'<span style="color:red"><iq-resulttext></iq-resulttext></span>',log:'<span style="color:purple"><iq-message></iq-message></span><br/>'};
b.templates=d;c=b.impl.TestGroup.prototype.run;e.tmpReplace=function(f,g){e.each(g,function(j,h){if(typeof h==="string"||typeof h==="number"){var k=f.find("iq-"+j.toLowerCase());
k.replaceWith(e.format("<span>{0}</span>",h));}});return f;};function a(f){var g=f?d.resultSuccess:d.resultFail;
return e.tmpReplace($(g),{resulttext:f?"Passed":"Failed"});}b.impl.TestGroup.prototype.run=function(){var f=$("#wrap");
f.empty();c.call(this).then(function(g){e.newChain(function(){g.group.render(f);});
});};e.extend(b.impl.TestGroup.prototype,{writer:function(f){var g=$(f);g.empty();
this.outputTarget=g;return this;},groupStart:function(f){var g=e.tmpReplace($(d.group).clone(),f);
this.outputTarget.append(g);this.groupWrapper=g;this.target=g.find("div:only-child:last");
},groupEnd:function(f){var g=a(f.passed);this.groupWrapper.find("iq-groupresult").replaceWith(g);
},render:function(f){this.outputTarget=f;e.each(this.tests,function(g,h){h.render();
});}});e.extend(b.impl.Test.prototype,{testStart:function(g){var f=e.tmpReplace($(d.testStart).clone(),g);
this.target=f.filter("div");this.group.target.append(f);},testEnd:function(h){var g,f=e.tmpReplace($(d.testEnd).clone(),h);
this.target.append(f);g=a(h.passed);this.target.find("iq-testresult").replaceWith(g);
},itemStart:function(g){var f=e.tmpReplace($(d.itemStart),g);this.itemTarget=f;this.target.append(f);
},itemEnd:function(f){if(f.passed){this.itemTarget.remove();}else{this.itemTarget.replaceWith(e.tmpReplace($(d.itemEnd).clone(),f));
}this.itemTarget=null;f.written=true;},log:function(f){this.target.append(e.tmpReplace($(d.log).clone(),{message:f}));
},render:function(){var f=this;e.each(f.results,function(g,h){if(!h.written){e.event(this.group.itemEnd,this.group,h);
}});}});b.writer=function(f){var g=new b.impl.TestGroup();g.writer(f);return g;};
b.impl.apiroot.writer=b.writer;}(iqtest));