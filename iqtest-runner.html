
<html>

<head>
	<title>IQTest Javascript Testing Framework Test Runner</title>
	<script type="text/javascript" src="jquery-1.7.1.js" /></script>
	<script type="text/javascript" src="when.js" /></script>
	<script type="text/javascript" src="timeout.js" /></script>
	<script type="text/javascript" src="iqtest.js" /></script>
	<script type="text/javascript" src="iqtest-html-harness.js" /></script>

</head>

<body>
<script type="text/javascript">
	/*jslint onevar: false */
	/*global when, iqtest */

	var glob;

	// returns a promise 
	var wait = function(secs) {
	    var defer = when.defer();
	    glob=10;
	    window.setTimeout(function() {
	        defer.resolve(secs);
	    },secs*1000);
	    return defer;    
	};
	var waitcb = function(secs,cb) {
		 window.setTimeout(function() {
	        cb(secs);
	    },secs*1000);
	};
	$(document).ready(function(){
		var group = iqtest.writer($('#wrap'));

		$('#startTest').bind('click',function(e) {
			group
			.configure({name: "Sample IQ Test Group"})
			.test("Large Test (#1)",function(a) {

				glob=0;
				a.areEqual(0,glob,"global value is 0")
					.isTrue(true,"should pass")
					.then(function() {
						a.areEqual(3,3,"Numbers are equal (#1)");
					}); 

				// uncomment to test testing error
				// throw("Test error")
				var y=false;

				// uncomment to test timeout error
				//a.resolves(wait(12),"Just waiting to resolve")
				a.resolves(wait(2),"Just waiting to resolve")
					.areEqual(2,wait(2),"Waited 2 secs and returned the parameter")
					.isTrue(waitcb(3,a.callback()),"Waited 3 secs");

				var cb = a.callback(function() {
					// uncomment to test testing error
					//throw("callback err");
					return 123;
				});
				a.areEqual(123,waitcb(3,cb),"Hoping to get 123");

				var backprom = a.backpromise(function(cb) {
					// uncomment to test testing error
					//throw("backpromise function error");
					$('#sample').hide('slow',cb);
				}, function(response) {
					// uncomment to test testing error
					//throw("backpromise callback error");
					return "xxx";
				});
			
				a.areEqual('xxx',backprom,"Hoping to get 'xxx'")

				.then(function() {
					a.isFalse(y,"y is false");
					a.areEqual(10,glob,"global got set by wait");	
					y=true;
				}).then(function()
				{
					a.areEqual(true,y,"y is now true");

				});

				a.areEqual(1,1,"Numbers are equal")
				.then(function()
				{
					throw("An error!");

				}).then(function()
				{
					throw("Never get here!");
				});
				// then try a callback
			})
			.test("Small Test (#2)",function(a) {
				var x=0;

				a.areEqual(2,wait(2),"A two second wait to show concurrent testing");
			    a.areEqual(3,wait(3),"Wait returns the parameter it was passed after a time");
				a.areEqual(0,x,"x is zero");
				
				a.then(function() {
					x=2;
					a.areEqual(2,x,"x is 2"); // 3rd assert: passes

				});


			});
		});


	});
</script>
	<p>
<b>Test Test Page</b> <a href="#" id="startTest">Run Tests</a>

</p>
<div id="wrap" >
</div>

<div id="sample">
Hello!!
</div>
</body>
</html>