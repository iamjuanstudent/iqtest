
<html>

<head>
	<title>IQTest Javascript Testing Framework Test Runner</title>
	<script type="text/javascript" src="jquery-1.7.1.js" /></script>
	<script type="text/javascript" src="when.js" /></script>
	<script type="text/javascript" src="timeout.js" /></script>
	<script type="text/javascript" src="iqtest.js" /></script>
	<script type="text/javascript" src="iqtest-html-harness.js" /></script>

</head>

<body>
<script type="text/javascript">
	/*jslint onevar: false */
	/*global when, iqtest */

	var glob;

	// returns a promise 
	var wait = function(secs) {
	    var defer = when.defer();
	    glob=10;
	    window.setTimeout(function() {
	        defer.resolve(secs);
	    },secs*1000);
	    return defer;    
	};
	var waitcb = function(secs,cb) {
		 window.setTimeout(function() {
	        cb(secs);
	    },secs*1000);
	};
	$(document).ready(function(){
		
		$('#startTest').bind('click',function(e) {
			iqtest
			.writer($('#wrap'))
			.test("test 1",function(a) {

				glob=0;
				a.areEqual(0,glob,"global value is 0")
					.isTrue(false,"Should fail")
					.then(function() {
						a.areEqual(3,3,"Should fail 3=3");
					}); 
 
				var y=false;
				a.resolves(wait(2),"Just waiting to resolve")
				.areEqual(2,wait(2),"Waited 2 secs and returned the parameter")
				.isTrue(waitcb(3,a.callback()),"Waited 3 secs");

				var cb = a.callback(function() {
					return 123;
				});
				a.areEqual(124,waitcb(3,cb),"Hoping to get 123");

				var backprom = a.backpromise(function(cb) {
					$('#sample').hide('slow',cb);
				}, function(response) {
					return "xxx";
				});
			
				a.areEqual('xxx',backprom,"Hoping to get 'xxx'")

				.then(function() {
					a.isFalse(y,"y is false");
					a.areEqual(10,glob,"global got set by wait");	
					y=true;
				}).then(function()
				{
					a.areEqual(true,y,"y is now true");

				});

				a.areEqual(1,1,"Numbers are equal");
				// then try a callback
			})
			.end();
		});


	});
</script>
	<p>
<b>Test Test Page</b> <a href="#" id="startTest">Run Tests</a>

</p>
<div id="wrap" >
</div>

<div id="sample">
Hello!!
</div>
</body>
</html>